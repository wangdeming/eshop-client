"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.BaseDriver = void 0;

require("source-map-support/register");

var _protocol = require("../protocol");

var _os = _interopRequireDefault(require("os"));

var _commands = _interopRequireDefault(require("./commands"));

var helpers = _interopRequireWildcard(require("./helpers"));

var _logger = _interopRequireDefault(require("./logger"));

var _deviceSettings = _interopRequireDefault(require("./device-settings"));

var _desiredCaps = require("./desired-caps");

var _capabilities = require("./capabilities");

var _bluebird = _interopRequireDefault(require("bluebird"));

var _lodash = _interopRequireDefault(require("lodash"));

var _appiumSupport = require("appium-support");

var _imageElement = require("./image-element");

const NEW_COMMAND_TIMEOUT_MS = 60 * 1000;
const EVENT_SESSION_INIT = 'newSessionRequested';
const EVENT_SESSION_START = 'newSessionStarted';
const EVENT_SESSION_QUIT_START = 'quitSessionRequested';
const EVENT_SESSION_QUIT_DONE = 'quitSessionFinished';

class BaseDriver extends _protocol.Protocol {
  constructor(opts = {}, shouldValidateCaps = true) {
    super();
    this.sessionId = null;
    this.opts = opts;
    this.caps = null;
    this.helpers = helpers;
    this.newCommandTimeoutMs = NEW_COMMAND_TIMEOUT_MS;
    this.implicitWaitMs = 0;
    this._constraints = _lodash.default.cloneDeep(_desiredCaps.desiredCapabilityConstraints);
    this.locatorStrategies = [];
    this.webLocatorStrategies = [];
    this.opts.tmpDir = this.opts.tmpDir || process.env.APPIUM_TMP_DIR || _os.default.tmpdir();
    this.curCommand = new _bluebird.default(r => {
      r();
    });
    this.curCommandCancellable = new _bluebird.default(r => {
      r();
    });
    this.shutdownUnexpectedly = false;
    this.noCommandTimer = null;
    this.shouldValidateCaps = shouldValidateCaps;
    this.settings = new _deviceSettings.default({}, _lodash.default.noop);
    this.resetOnUnexpectedShutdown();
    this.initialOpts = _lodash.default.cloneDeep(this.opts);
    this.managedDrivers = [];
    this._eventHistory = {
      commands: []
    };
    this._imgElCache = (0, _imageElement.makeImageElementCache)();
    this.protocol = null;
  }

  get driverData() {
    return {};
  }

  get isCommandsQueueEnabled() {
    return true;
  }

  get eventHistory() {
    return _lodash.default.cloneDeep(this._eventHistory);
  }

  logEvent(eventName) {
    if (eventName === 'commands') {
      throw new Error('Cannot log commands directly');
    }

    if (typeof eventName !== 'string') {
      throw new Error(`Invalid eventName ${eventName}`);
    }

    if (!this._eventHistory[eventName]) {
      this._eventHistory[eventName] = [];
    }

    let ts = Date.now();
    let logTime = new Date(ts).toTimeString();

    this._eventHistory[eventName].push(ts);

    _logger.default.debug(`Event '${eventName}' logged at ${ts} (${logTime})`);
  }

  async getStatus() {
    return {};
  }

  resetOnUnexpectedShutdown() {
    if (this.onUnexpectedShutdown && !this.onUnexpectedShutdown.isFulfilled()) {
      this.onUnexpectedShutdown.cancel();
    }

    this.onUnexpectedShutdown = new _bluebird.default((resolve, reject) => {
      this.unexpectedShutdownDeferred = {
        resolve,
        reject
      };
    }).cancellable();
    this.onUnexpectedShutdown.catch(() => {});
  }

  set desiredCapConstraints(constraints) {
    this._constraints = Object.assign(this._constraints, constraints);

    for (const [, value] of _lodash.default.toPairs(this._constraints)) {
      if (value && value.presence === true) {
        value.presence = {
          allowEmpty: false
        };
      }
    }
  }

  get desiredCapConstraints() {
    return this._constraints;
  }

  sessionExists(sessionId) {
    if (!sessionId) return false;
    return sessionId === this.sessionId;
  }

  driverForSession() {
    return this;
  }

  logExtraCaps(caps) {
    let extraCaps = _lodash.default.difference(_lodash.default.keys(caps), _lodash.default.keys(this._constraints));

    if (extraCaps.length) {
      _logger.default.warn(`The following capabilities were provided, but are not ` + `recognized by appium: ${extraCaps.join(', ')}.`);
    }
  }

  validateDesiredCaps(caps) {
    if (!this.shouldValidateCaps) {
      return true;
    }

    try {
      (0, _capabilities.validateCaps)(caps, this._constraints);
    } catch (e) {
      _logger.default.errorAndThrow(new _protocol.errors.SessionNotCreatedError(`The desiredCapabilities object was not valid for the ` + `following reason(s): ${e.message}`));
    }

    this.logExtraCaps(caps);
    return true;
  }

  isMjsonwpProtocol() {
    return this.protocol === BaseDriver.DRIVER_PROTOCOL.MJSONWP;
  }

  isW3CProtocol() {
    return this.protocol === BaseDriver.DRIVER_PROTOCOL.W3C;
  }

  setProtocolMJSONWP() {
    this.protocol = BaseDriver.DRIVER_PROTOCOL.MJSONWP;
  }

  setProtocolW3C() {
    this.protocol = BaseDriver.DRIVER_PROTOCOL.W3C;
  }

  static determineProtocol(desiredCapabilities, requiredCapabilities, capabilities) {
    return _lodash.default.isPlainObject(capabilities) ? BaseDriver.DRIVER_PROTOCOL.W3C : BaseDriver.DRIVER_PROTOCOL.MJSONWP;
  }

  async executeCommand(cmd, ...args) {
    let startTime = Date.now();

    if (cmd === 'createSession') {
      this.protocol = BaseDriver.determineProtocol(...args);
      this.logEvent(EVENT_SESSION_INIT);
    } else if (cmd === 'deleteSession') {
      this.logEvent(EVENT_SESSION_QUIT_START);
    }

    this.clearNewCommandTimeout();
    const imgElId = (0, _imageElement.getImgElFromArgs)(args);

    if (!this[cmd] && !imgElId) {
      throw new _protocol.errors.NotYetImplementedError();
    }

    let res;

    if (this.isCommandsQueueEnabled) {
      let nextCommand = this.curCommand.then(() => {
        if (this.shutdownUnexpectedly) {
          return _bluebird.default.reject(new _protocol.errors.NoSuchDriverError('The driver was unexpectedly shut down!'));
        }

        this.curCommandCancellable = _bluebird.default.resolve().then(() => {
          if (imgElId) {
            return _imageElement.ImageElement.execute(this, cmd, imgElId);
          }

          return this[cmd](...args);
        }).cancellable();
        return this.curCommandCancellable;
      });
      this.curCommand = nextCommand.catch(() => {});
      res = await nextCommand;
    } else {
      if (this.shutdownUnexpectedly) {
        throw new _protocol.errors.NoSuchDriverError('The driver was unexpectedly shut down!');
      }

      res = await this[cmd](...args);
    }

    if (this.isCommandsQueueEnabled && cmd !== 'deleteSession') {
      this.startNewCommandTimeout();
    }

    let endTime = Date.now();

    this._eventHistory.commands.push({
      cmd,
      startTime,
      endTime
    });

    if (cmd === 'createSession') {
      this.logEvent(EVENT_SESSION_START);
    } else if (cmd === 'deleteSession') {
      this.logEvent(EVENT_SESSION_QUIT_DONE);
    }

    return res;
  }

  async startUnexpectedShutdown(err = new _protocol.errors.NoSuchDriverError('The driver was unexpectedly shut down!')) {
    this.unexpectedShutdownDeferred.reject(err);
    this.shutdownUnexpectedly = true;
    await this.deleteSession(this.sessionId);
    this.shutdownUnexpectedly = false;
    this.curCommandCancellable.cancel(err);
  }

  validateLocatorStrategy(strategy, webContext = false) {
    let validStrategies = this.locatorStrategies;

    _logger.default.debug(`Valid locator strategies for this request: ${validStrategies.join(', ')}`);

    if (webContext) {
      validStrategies = validStrategies.concat(this.webLocatorStrategies);
    }

    if (!_lodash.default.includes(validStrategies, strategy)) {
      throw new _protocol.errors.InvalidSelectorError(`Locator Strategy '${strategy}' is not supported for this session`);
    }
  }

  async reset() {
    _logger.default.debug('Resetting app mid-session');

    _logger.default.debug('Running generic full reset');

    let currentConfig = {};

    for (let property of ['implicitWaitMs', 'newCommandTimeoutMs', 'sessionId', 'resetOnUnexpectedShutdown']) {
      currentConfig[property] = this[property];
    }

    this.resetOnUnexpectedShutdown = () => {};

    const args = this.protocol === BaseDriver.DRIVER_PROTOCOL.W3C ? [undefined, undefined, {
      alwaysMatch: this.caps,
      firstMatch: [{}]
    }] : [this.caps];

    try {
      await this.deleteSession(this.sessionId);

      _logger.default.debug('Restarting app');

      await this.createSession(...args);
    } finally {
      for (let [key, value] of _lodash.default.toPairs(currentConfig)) {
        this[key] = value;
      }
    }

    this.clearNewCommandTimeout();
  }

  async getSwipeOptions(gestures, touchCount = 1) {
    let startX = this.helpers.getCoordDefault(gestures[0].options.x),
        startY = this.helpers.getCoordDefault(gestures[0].options.y),
        endX = this.helpers.getCoordDefault(gestures[2].options.x),
        endY = this.helpers.getCoordDefault(gestures[2].options.y),
        duration = this.helpers.getSwipeTouchDuration(gestures[1]),
        element = gestures[0].options.element,
        destElement = gestures[2].options.element || gestures[0].options.element;

    if (_appiumSupport.util.hasValue(destElement)) {
      let locResult = await this.getLocationInView(destElement);
      let sizeResult = await this.getSize(destElement);
      let offsetX = Math.abs(endX) < 1 && Math.abs(endX) > 0 ? sizeResult.width * endX : endX;
      let offsetY = Math.abs(endY) < 1 && Math.abs(endY) > 0 ? sizeResult.height * endY : endY;
      endX = locResult.x + offsetX;
      endY = locResult.y + offsetY;

      if (_appiumSupport.util.hasValue(element)) {
        let firstElLocation = await this.getLocationInView(element);
        endX -= firstElLocation.x;
        endY -= firstElLocation.y;
      }
    }

    return {
      startX,
      startY,
      endX,
      endY,
      duration,
      touchCount,
      element
    };
  }

  proxyActive() {
    return false;
  }

  getProxyAvoidList() {
    return [];
  }

  canProxy() {
    return false;
  }

  proxyRouteIsAvoided(sessionId, method, url) {
    for (let avoidSchema of this.getProxyAvoidList(sessionId)) {
      if (!_lodash.default.isArray(avoidSchema) || avoidSchema.length !== 2) {
        throw new Error('Proxy avoidance must be a list of pairs');
      }

      let [avoidMethod, avoidPathRegex] = avoidSchema;

      if (!_lodash.default.includes(['GET', 'POST', 'DELETE'], avoidMethod)) {
        throw new Error(`Unrecognized proxy avoidance method '${avoidMethod}'`);
      }

      if (!_lodash.default.isRegExp(avoidPathRegex)) {
        throw new Error('Proxy avoidance path must be a regular expression');
      }

      let normalizedUrl = url.replace(/^\/wd\/hub/, '');

      if (avoidMethod === method && avoidPathRegex.test(normalizedUrl)) {
        return true;
      }
    }

    return false;
  }

  addManagedDriver(driver) {
    this.managedDrivers.push(driver);
  }

  getManagedDrivers() {
    return this.managedDrivers;
  }

}

exports.BaseDriver = BaseDriver;
BaseDriver.DRIVER_PROTOCOL = {
  W3C: 'W3C',
  MJSONWP: 'MJSONWP'
};

for (let [cmd, fn] of _lodash.default.toPairs(_commands.default)) {
  BaseDriver.prototype[cmd] = fn;
}

var _default = BaseDriver;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9iYXNlZHJpdmVyL2RyaXZlci5qcyJdLCJuYW1lcyI6WyJORVdfQ09NTUFORF9USU1FT1VUX01TIiwiRVZFTlRfU0VTU0lPTl9JTklUIiwiRVZFTlRfU0VTU0lPTl9TVEFSVCIsIkVWRU5UX1NFU1NJT05fUVVJVF9TVEFSVCIsIkVWRU5UX1NFU1NJT05fUVVJVF9ET05FIiwiQmFzZURyaXZlciIsIlByb3RvY29sIiwiY29uc3RydWN0b3IiLCJvcHRzIiwic2hvdWxkVmFsaWRhdGVDYXBzIiwic2Vzc2lvbklkIiwiY2FwcyIsImhlbHBlcnMiLCJuZXdDb21tYW5kVGltZW91dE1zIiwiaW1wbGljaXRXYWl0TXMiLCJfY29uc3RyYWludHMiLCJfIiwiY2xvbmVEZWVwIiwiZGVzaXJlZENhcGFiaWxpdHlDb25zdHJhaW50cyIsImxvY2F0b3JTdHJhdGVnaWVzIiwid2ViTG9jYXRvclN0cmF0ZWdpZXMiLCJ0bXBEaXIiLCJwcm9jZXNzIiwiZW52IiwiQVBQSVVNX1RNUF9ESVIiLCJvcyIsInRtcGRpciIsImN1ckNvbW1hbmQiLCJCIiwiciIsImN1ckNvbW1hbmRDYW5jZWxsYWJsZSIsInNodXRkb3duVW5leHBlY3RlZGx5Iiwibm9Db21tYW5kVGltZXIiLCJzZXR0aW5ncyIsIkRldmljZVNldHRpbmdzIiwibm9vcCIsInJlc2V0T25VbmV4cGVjdGVkU2h1dGRvd24iLCJpbml0aWFsT3B0cyIsIm1hbmFnZWREcml2ZXJzIiwiX2V2ZW50SGlzdG9yeSIsImNvbW1hbmRzIiwiX2ltZ0VsQ2FjaGUiLCJwcm90b2NvbCIsImRyaXZlckRhdGEiLCJpc0NvbW1hbmRzUXVldWVFbmFibGVkIiwiZXZlbnRIaXN0b3J5IiwibG9nRXZlbnQiLCJldmVudE5hbWUiLCJFcnJvciIsInRzIiwiRGF0ZSIsIm5vdyIsImxvZ1RpbWUiLCJ0b1RpbWVTdHJpbmciLCJwdXNoIiwibG9nIiwiZGVidWciLCJnZXRTdGF0dXMiLCJvblVuZXhwZWN0ZWRTaHV0ZG93biIsImlzRnVsZmlsbGVkIiwiY2FuY2VsIiwicmVzb2x2ZSIsInJlamVjdCIsInVuZXhwZWN0ZWRTaHV0ZG93bkRlZmVycmVkIiwiY2FuY2VsbGFibGUiLCJjYXRjaCIsImRlc2lyZWRDYXBDb25zdHJhaW50cyIsImNvbnN0cmFpbnRzIiwiT2JqZWN0IiwiYXNzaWduIiwidmFsdWUiLCJ0b1BhaXJzIiwicHJlc2VuY2UiLCJhbGxvd0VtcHR5Iiwic2Vzc2lvbkV4aXN0cyIsImRyaXZlckZvclNlc3Npb24iLCJsb2dFeHRyYUNhcHMiLCJleHRyYUNhcHMiLCJkaWZmZXJlbmNlIiwia2V5cyIsImxlbmd0aCIsIndhcm4iLCJqb2luIiwidmFsaWRhdGVEZXNpcmVkQ2FwcyIsImUiLCJlcnJvckFuZFRocm93IiwiZXJyb3JzIiwiU2Vzc2lvbk5vdENyZWF0ZWRFcnJvciIsIm1lc3NhZ2UiLCJpc01qc29ud3BQcm90b2NvbCIsIkRSSVZFUl9QUk9UT0NPTCIsIk1KU09OV1AiLCJpc1czQ1Byb3RvY29sIiwiVzNDIiwic2V0UHJvdG9jb2xNSlNPTldQIiwic2V0UHJvdG9jb2xXM0MiLCJkZXRlcm1pbmVQcm90b2NvbCIsImRlc2lyZWRDYXBhYmlsaXRpZXMiLCJyZXF1aXJlZENhcGFiaWxpdGllcyIsImNhcGFiaWxpdGllcyIsImlzUGxhaW5PYmplY3QiLCJleGVjdXRlQ29tbWFuZCIsImNtZCIsImFyZ3MiLCJzdGFydFRpbWUiLCJjbGVhck5ld0NvbW1hbmRUaW1lb3V0IiwiaW1nRWxJZCIsIk5vdFlldEltcGxlbWVudGVkRXJyb3IiLCJyZXMiLCJuZXh0Q29tbWFuZCIsInRoZW4iLCJOb1N1Y2hEcml2ZXJFcnJvciIsIkltYWdlRWxlbWVudCIsImV4ZWN1dGUiLCJzdGFydE5ld0NvbW1hbmRUaW1lb3V0IiwiZW5kVGltZSIsInN0YXJ0VW5leHBlY3RlZFNodXRkb3duIiwiZXJyIiwiZGVsZXRlU2Vzc2lvbiIsInZhbGlkYXRlTG9jYXRvclN0cmF0ZWd5Iiwic3RyYXRlZ3kiLCJ3ZWJDb250ZXh0IiwidmFsaWRTdHJhdGVnaWVzIiwiY29uY2F0IiwiaW5jbHVkZXMiLCJJbnZhbGlkU2VsZWN0b3JFcnJvciIsInJlc2V0IiwiY3VycmVudENvbmZpZyIsInByb3BlcnR5IiwidW5kZWZpbmVkIiwiYWx3YXlzTWF0Y2giLCJmaXJzdE1hdGNoIiwiY3JlYXRlU2Vzc2lvbiIsImtleSIsImdldFN3aXBlT3B0aW9ucyIsImdlc3R1cmVzIiwidG91Y2hDb3VudCIsInN0YXJ0WCIsImdldENvb3JkRGVmYXVsdCIsIm9wdGlvbnMiLCJ4Iiwic3RhcnRZIiwieSIsImVuZFgiLCJlbmRZIiwiZHVyYXRpb24iLCJnZXRTd2lwZVRvdWNoRHVyYXRpb24iLCJlbGVtZW50IiwiZGVzdEVsZW1lbnQiLCJ1dGlsIiwiaGFzVmFsdWUiLCJsb2NSZXN1bHQiLCJnZXRMb2NhdGlvbkluVmlldyIsInNpemVSZXN1bHQiLCJnZXRTaXplIiwib2Zmc2V0WCIsIk1hdGgiLCJhYnMiLCJ3aWR0aCIsIm9mZnNldFkiLCJoZWlnaHQiLCJmaXJzdEVsTG9jYXRpb24iLCJwcm94eUFjdGl2ZSIsImdldFByb3h5QXZvaWRMaXN0IiwiY2FuUHJveHkiLCJwcm94eVJvdXRlSXNBdm9pZGVkIiwibWV0aG9kIiwidXJsIiwiYXZvaWRTY2hlbWEiLCJpc0FycmF5IiwiYXZvaWRNZXRob2QiLCJhdm9pZFBhdGhSZWdleCIsImlzUmVnRXhwIiwibm9ybWFsaXplZFVybCIsInJlcGxhY2UiLCJ0ZXN0IiwiYWRkTWFuYWdlZERyaXZlciIsImRyaXZlciIsImdldE1hbmFnZWREcml2ZXJzIiwiZm4iLCJwcm90b3R5cGUiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFHQSxNQUFNQSxzQkFBc0IsR0FBRyxLQUFLLElBQXBDO0FBRUEsTUFBTUMsa0JBQWtCLEdBQUcscUJBQTNCO0FBQ0EsTUFBTUMsbUJBQW1CLEdBQUcsbUJBQTVCO0FBQ0EsTUFBTUMs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QUFWLENBQXRCLEVBQTJDO0FBQ3pDbkMsRUFBQUEsVUFBVSxDQUFDK0ssU0FBWCxDQUFxQjlFLEdBQXJCLElBQTRCNkUsRUFBNUI7QUFDRDs7ZUFHYzlLLFUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQcm90b2NvbCwgZXJyb3JzIH0gZnJvbSAnLi4vcHJvdG9jb2wnO1xuaW1wb3J0IG9zIGZyb20gJ29zJztcbmltcG9ydCBjb21tYW5kcyBmcm9tICcuL2NvbW1hbmRzJztcbmltcG9ydCAqIGFzIGhlbHBlcnMgZnJvbSAnLi9oZWxwZXJzJztcbmltcG9ydCBsb2cgZnJvbSAnLi9sb2dnZXInO1xuaW1wb3J0IERldmljZVNldHRpbmdzIGZyb20gJy4vZGV2aWNlLXNldHRpbmdzJztcbmltcG9ydCB7IGRlc2lyZWRDYXBhYmlsaXR5Q29uc3RyYWludHMgfSBmcm9tICcuL2Rlc2lyZWQtY2Fwcyc7XG5pbXBvcnQgeyB2YWxpZGF0ZUNhcHMgfSBmcm9tICcuL2NhcGFiaWxpdGllcyc7XG5pbXBvcnQgQiBmcm9tICdibHVlYmlyZCc7XG5pbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IHsgdXRpbCB9IGZyb20gJ2FwcGl1bS1zdXBwb3J0JztcbmltcG9ydCB7IEltYWdlRWxlbWVudCwgbWFrZUltYWdlRWxlbWVudENhY2hlLCBnZXRJbWdFbEZyb21BcmdzIH0gZnJvbSAnLi9pbWFnZS1lbGVtZW50JztcblxuXG5jb25zdCBORVdfQ09NTUFORF9USU1FT1VUX01TID0gNjAgKiAxMDAwO1xuXG5jb25zdCBFVkVOVF9TRVNTSU9OX0lOSVQgPSAnbmV3U2Vzc2lvblJlcXVlc3RlZCc7XG5jb25zdCBFVkVOVF9TRVNTSU9OX1NUQVJUID0gJ25ld1Nlc3Npb25TdGFydGVkJztcbmNvbnN0IEVWRU5UX1NFU1NJT05fUVVJVF9TVEFSVCA9ICdxdWl0U2Vzc2lvblJlcXVlc3RlZCc7XG5jb25zdCBFVkVOVF9TRVNTSU9OX1FVSVRfRE9ORSA9ICdxdWl0U2Vzc2lvbkZpbmlzaGVkJztcblxuY2xhc3MgQmFzZURyaXZlciBleHRlbmRzIFByb3RvY29sIHtcblxuICBjb25zdHJ1Y3RvciAob3B0cyA9IHt9LCBzaG91bGRWYWxpZGF0ZUNhcHMgPSB0cnVlKSB7XG4gICAgc3VwZXIoKTtcblxuICAgIC8vIHNldHVwIHN0YXRlXG4gICAgdGhpcy5zZXNzaW9uSWQgPSBudWxsO1xuICAgIHRoaXMub3B0cyA9IG9wdHM7XG4gICAgdGhpcy5jYXBzID0gbnVsbDtcbiAgICB0aGlzLmhlbHBlcnMgPSBoZWxwZXJzO1xuXG4gICAgLy8gdGltZW91dCBpbml0aWFsaXphdGlvblxuICAgIHRoaXMubmV3Q29tbWFuZFRpbWVvdXRNcyA9IE5FV19DT01NQU5EX1RJTUVPVVRfTVM7XG4gICAgdGhpcy5pbXBsaWNpdFdhaXRNcyA9IDA7XG5cbiAgICB0aGlzLl9jb25zdHJhaW50cyA9IF8uY2xvbmVEZWVwKGRlc2lyZWRDYXBhYmlsaXR5Q29uc3RyYWludHMpO1xuICAgIHRoaXMubG9jYXRvclN0cmF0ZWdpZXMgPSBbXTtcbiAgICB0aGlzLndlYkxvY2F0b3JTdHJhdGVnaWVzID0gW107XG5cbiAgICAvLyB1c2UgYSBjdXN0b20gdG1wIGRpciB0byBhdm9pZCBsb3NpbmcgZGF0YSBhbmQgYXBwIHdoZW4gY29tcHV0ZXIgaXNcbiAgICAvLyByZXN0YXJ0ZWRcbiAgICB0aGlzLm9wdHMudG1wRGlyID0gdGhpcy5vcHRzLnRtcERpciB8fFxuICAgICAgICAgICAgICAgICAgICAgICBwcm9jZXNzLmVudi5BUFBJVU1fVE1QX0RJUiB8fFxuICAgICAgICAgICAgICAgICAgICAgICBvcy50bXBkaXIoKTtcblxuICAgIC8vIGJhc2UtZHJpdmVyIGludGVybmFsc1xuICAgIHRoaXMuY3VyQ29tbWFuZCA9IG5ldyBCKChyKSA9PiB7IHIoKTsgfSk7IC8vIHNlZSBub3RlIGluIGV4ZWN1dGVcbiAgICB0aGlzLmN1ckNvbW1hbmRDYW5jZWxsYWJsZSA9IG5ldyBCKChyKSA9PiB7IHIoKTsgfSk7IC8vIHNlZSBub3RlIGluIGV4ZWN1dGVcbiAgICB0aGlzLnNodXRkb3duVW5leHBlY3RlZGx5ID0gZmFsc2U7XG4gICAgdGhpcy5ub0NvbW1hbmRUaW1lciA9IG51bGw7XG4gICAgdGhpcy5zaG91bGRWYWxpZGF0ZUNhcHMgPSBzaG91bGRWYWxpZGF0ZUNhcHM7XG5cbiAgICAvLyBzZXR0aW5ncyBzaG91bGQgYmUgaW5zdGFudGlhdGVkIGJ5IGRyaXZlcnMgd2hpY2ggZXh0ZW5kIEJhc2VEcml2ZXIsIGJ1dFxuICAgIC8vIHdlIHNldCBpdCB0byBhbiBlbXB0eSBEZXZpY2VTZXR0aW5ncyBpbnN0YW5jZSBoZXJlIHRvIG1ha2Ugc3VyZSB0aGF0IHRoZVxuICAgIC8vIGRlZmF1bHQgc2V0dGluZ3MgYXJlIGFwcGxpZWQgZXZlbiBpZiBhbiBleHRlbmRpbmcgZHJpdmVyIGRvZXNuJ3QgdXRpbGl6ZVxuICAgIC8vIHRoZSBzZXR0aW5ncyBmdW5jdGlvbmFsaXR5IGl0c2VsZlxuICAgIHRoaXMuc2V0dGluZ3MgPSBuZXcgRGV2aWNlU2V0dGluZ3Moe30sIF8ubm9vcCk7XG5cbiAgICB0aGlzLnJlc2V0T25VbmV4cGVjdGVkU2h1dGRvd24oKTtcblxuICAgIC8vIGtlZXBpbmcgdHJhY2sgb2YgaW5pdGlhbCBvcHRzXG4gICAgdGhpcy5pbml0aWFsT3B0cyA9IF8uY2xvbmVEZWVwKHRoaXMub3B0cyk7XG5cbiAgICAvLyBhbGxvdyBzdWJjbGFzc2VzIHRvIGhhdmUgaW50ZXJuYWwgZHJpdmVyc1xuICAgIHRoaXMubWFuYWdlZERyaXZlcnMgPSBbXTtcblxuICAgIC8vIHN0b3JlIGV2ZW50IHRpbWluZ3NcbiAgICB0aGlzLl9ldmVudEhpc3RvcnkgPSB7XG4gICAgICBjb21tYW5kczogW10gLy8gY29tbWFuZHMgZ2V0IGEgc3BlY2lhbCBwbGFjZVxuICAgIH07XG5cbiAgICAvLyBjYWNoZSB0aGUgaW1hZ2UgZWxlbWVudHNcbiAgICB0aGlzLl9pbWdFbENhY2hlID0gbWFrZUltYWdlRWxlbWVudENhY2hlKCk7XG5cbiAgICB0aGlzLnByb3RvY29sID0gbnVsbDtcbiAgfVxuXG4gIC8qKlxuICAgKiBUaGlzIHByb3BlcnR5IGlzIHVzZWQgYnkgQXBwaXVtRHJpdmVyIHRvIHN0b3JlIHRoZSBkYXRhIG9mIHRoZVxuICAgKiBzcGVjaWZpYyBkcml2ZXIgc2Vzc2lvbnMuIFRoaXMgZGF0YSBjYW4gYmUgbGF0ZXIgdXNlZCB0byBhZGp1c3RcbiAgICogcHJvcGVydGllcyBmb3IgZHJpdmVyIGluc3RhbmNlcyBydW5uaW5nIGluIHBhcmFsbGVsLlxuICAgKiBPdmVycmlkZSBpdCBpbiBpbmhlcml0ZWQgZHJpdmVyIGNsYXNzZXMgaWYgbmVjZXNzYXJ5LlxuICAgKlxuICAgKiBAcmV0dXJuIHtvYmplY3R9IERyaXZlciBwcm9wZXJ0aWVzIG1hcHBpbmdcbiAgICovXG4gIGdldCBkcml2ZXJEYXRhICgpIHtcbiAgICByZXR1cm4ge307XG4gIH1cblxuICAvKipcbiAgICogVGhpcyBwcm9wZXJ0eSBjb250cm9scyB0aGUgd2F5IHsjZXhlY3V0ZUNvbW1hbmR9IG1ldGhvZFxuICAgKiBoYW5kbGVzIG5ldyBkcml2ZXIgY29tbWFuZHMgcmVjZWl2ZWQgZnJvbSB0aGUgY2xpZW50LlxuICAgKiBPdmVycmlkZSBpdCBmb3IgaW5oZXJpdGVkIGNsYXNzZXMgb25seSBpbiBzcGVjaWFsIGNhc2VzLlxuICAgKlxuICAgKiBAcmV0dXJuIHtib29sZWFufSBJZiB0aGUgcmV0dXJuZWQgdmFsdWUgaXMgdHJ1ZSAoZGVmYXVsdCkgdGhlbiBhbGwgdGhlIGNvbW1hbmRzXG4gICAqICAgcmVjZWl2ZWQgYnkgdGhlIHBhcnRpY3VsYXIgZHJpdmVyIGluc3RhbmNlIGFyZSBnb2luZyB0byBiZSBwdXQgaW50byB0aGUgcXVldWUsXG4gICAqICAgc28gZWFjaCBmb2xsb3dpbmcgY29tbWFuZCB3aWxsIG5vdCBiZSBleGVjdXRlZCB1bnRpbCB0aGUgcHJldmlvdXMgY29tbWFuZFxuICAgKiAgIGV4ZWN1dGlvbiBpcyBjb21wbGV0ZWQuIEZhbHNlIHZhbHVlIGRpc2FibGVzIHRoYXQgcXVldWUsIHNvIGVhY2ggZHJpdmVyIGNvbW1hbmRcbiAgICogICBpcyBleGVjdXRlZCBpbmRlcGVuZGVudGx5IGFuZCBkb2VzIG5vdCB3YWl0IGZvciBhbnl0aGluZy5cbiAgICovXG4gIGdldCBpc0NvbW1hbmRzUXVldWVFbmFibGVkICgpIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIC8qXG4gICAqIG1ha2UgZXZlbnRIaXN0b3J5IGEgcHJvcGVydHkgYW5kIHJldHVybiBhIGNsb25lZCBvYmplY3Qgc28gYSBjb25zdW1lciBjYW4ndFxuICAgKiBpbmFkdmVydGVudGx5IGNoYW5nZSBkYXRhIG91dHNpZGUgb2YgbG9nRXZlbnRcbiAgICovXG4gIGdldCBldmVudEhpc3RvcnkgKCkge1xuICAgIHJldHVybiBfLmNsb25lRGVlcCh0aGlzLl9ldmVudEhpc3RvcnkpO1xuICB9XG5cbiAgLypcbiAgICogQVBJIG1ldGhvZCBmb3IgZHJpdmVyIGRldmVsb3BlcnMgdG8gbG9nIHRpbWluZ3MgZm9yIGltcG9ydGFudCBldmVudHNcbiAgICovXG4gIGxvZ0V2ZW50IChldmVudE5hbWUpIHtcbiAgICBpZiAoZXZlbnROYW1lID09PSAnY29tbWFuZHMnKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0Nhbm5vdCBsb2cgY29tbWFuZHMgZGlyZWN0bHknKTtcbiAgICB9XG4gICAgaWYgKHR5cGVvZiBldmVudE5hbWUgIT09ICdzdHJpbmcnKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgZXZlbnROYW1lICR7ZXZlbnROYW1lfWApO1xuICAgIH1cbiAgICBpZiAoIXRoaXMuX2V2ZW50SGlzdG9yeVtldmVudE5hbWVdKSB7XG4gICAgICB0aGlzLl9ldmVudEhpc3RvcnlbZXZlbnROYW1lXSA9IFtdO1xuICAgIH1cbiAgICBsZXQgdHMgPSBEYXRlLm5vdygpO1xuICAgIGxldCBsb2dUaW1lID0gKG5ldyBEYXRlKHRzKSkudG9UaW1lU3RyaW5nKCk7XG4gICAgdGhpcy5fZXZlbnRIaXN0b3J5W2V2ZW50TmFtZV0ucHVzaCh0cyk7XG4gICAgbG9nLmRlYnVnKGBFdmVudCAnJHtldmVudE5hbWV9JyBsb2dnZWQgYXQgJHt0c30gKCR7bG9nVGltZX0pYCk7XG4gIH1cblxuICAvKlxuICAgKiBPdmVycmlkZGVuIGluIGFwcGl1bSBkcml2ZXIsIGJ1dCBoZXJlIHNvIHRoYXQgaW5kaXZpZHVhbCBkcml2ZXJzIGNhbiBiZVxuICAgKiB0ZXN0ZWQgd2l0aCBjbGllbnRzIHRoYXQgcG9sbFxuICAgKi9cbiAgYXN5bmMgZ2V0U3RhdHVzICgpIHsgLy8gZXNsaW50LWRpc2FibGUtbGluZSByZXF1aXJlLWF3YWl0XG4gICAgcmV0dXJuIHt9O1xuICB9XG5cbiAgLypcbiAgICogSW5pdGlhbGl6ZSBhIG5ldyBvblVuZXhwZWN0ZWRTaHV0ZG93biBwcm9taXNlLCBjYW5jZWxsaW5nIGV4aXN0aW5nIG9uZS5cbiAgICovXG4gIHJlc2V0T25VbmV4cGVjdGVkU2h1dGRvd24gKCkge1xuICAgIGlmICh0aGlzLm9uVW5leHBlY3RlZFNodXRkb3duICYmICF0aGlzLm9uVW5leHBlY3RlZFNodXRkb3duLmlzRnVsZmlsbGVkKCkpIHtcbiAgICAgIHRoaXMub25VbmV4cGVjdGVkU2h1dGRvd24uY2FuY2VsKCk7XG4gICAgfVxuICAgIHRoaXMub25VbmV4cGVjdGVkU2h1dGRvd24gPSBuZXcgQigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICB0aGlzLnVuZXhwZWN0ZWRTaHV0ZG93bkRlZmVycmVkID0ge3Jlc29sdmUsIHJlamVjdH07XG4gICAgfSkuY2FuY2VsbGFibGUoKTtcbiAgICAvLyBub29wIGhhbmRsZXIgdG8gYXZvaWQgd2FybmluZy5cbiAgICB0aGlzLm9uVW5leHBlY3RlZFNodXRkb3duLmNhdGNoKCgpID0+IHt9KTtcbiAgfVxuXG4gIC8vIHdlIG9ubHkgd2FudCBzdWJjbGFzc2VzIHRvIGV2ZXIgZXh0ZW5kIHRoZSBjb250cmFpbnRzXG4gIHNldCBkZXNpcmVkQ2FwQ29uc3RyYWludHMgKGNvbnN0cmFpbnRzKSB7XG4gICAgdGhpcy5fY29uc3RyYWludHMgPSBPYmplY3QuYXNzaWduKHRoaXMuX2NvbnN0cmFpbnRzLCBjb25zdHJhaW50cyk7XG4gICAgLy8gJ3ByZXNlbmNlJyBtZWFucyBkaWZmZXJlbnQgdGhpbmdzIGluIGRpZmZlcmVudCB2ZXJzaW9ucyBvZiB0aGUgdmFsaWRhdG9yLFxuICAgIC8vIHdoZW4gd2Ugc2F5ICd0cnVlJyB3ZSBtZWFuIHRoYXQgaXQgc2hvdWxkIG5vdCBiZSBhYmxlIHRvIGJlIGVtcHR5XG4gICAgZm9yIChjb25zdCBbLCB2YWx1ZV0gb2YgXy50b1BhaXJzKHRoaXMuX2NvbnN0cmFpbnRzKSkge1xuICAgICAgaWYgKHZhbHVlICYmIHZhbHVlLnByZXNlbmNlID09PSB0cnVlKSB7XG4gICAgICAgIHZhbHVlLnByZXNlbmNlID0ge1xuICAgICAgICAgIGFsbG93RW1wdHk6IGZhbHNlLFxuICAgICAgICB9O1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGdldCBkZXNpcmVkQ2FwQ29uc3RyYWludHMgKCkge1xuICAgIHJldHVybiB0aGlzLl9jb25zdHJhaW50cztcbiAgfVxuXG4gIC8vIG1ldGhvZCByZXF1aXJlZCBieSBNSlNPTldQIGluIG9yZGVyIHRvIGRldGVybWluZSB3aGV0aGVyIGl0IHNob3VsZFxuICAvLyByZXNwb25kIHdpdGggYW4gaW52YWxpZCBzZXNzaW9uIHJlc3BvbnNlXG4gIHNlc3Npb25FeGlzdHMgKHNlc3Npb25JZCkge1xuICAgIGlmICghc2Vzc2lvbklkKSByZXR1cm4gZmFsc2U7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgY3VybHlcbiAgICByZXR1cm4gc2Vzc2lvbklkID09PSB0aGlzLnNlc3Npb25JZDtcbiAgfVxuXG4gIC8vIG1ldGhvZCByZXF1aXJlZCBieSBNSlNPTldQIGluIG9yZGVyIHRvIGRldGVybWluZSBpZiB0aGUgY29tbWFuZCBzaG91bGRcbiAgLy8gYmUgcHJveGllZCBkaXJlY3RseSB0byB0aGUgZHJpdmVyXG4gIGRyaXZlckZvclNlc3Npb24gKC8qc2Vzc2lvbklkKi8pIHtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIGxvZ0V4dHJhQ2FwcyAoY2Fwcykge1xuICAgIGxldCBleHRyYUNhcHMgPSBfLmRpZmZlcmVuY2UoXy5rZXlzKGNhcHMpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXy5rZXlzKHRoaXMuX2NvbnN0cmFpbnRzKSk7XG4gICAgaWYgKGV4dHJhQ2Fwcy5sZW5ndGgpIHtcbiAgICAgIGxvZy53YXJuKGBUaGUgZm9sbG93aW5nIGNhcGFiaWxpdGllcyB3ZXJlIHByb3ZpZGVkLCBidXQgYXJlIG5vdCBgICtcbiAgICAgICAgICAgICAgIGByZWNvZ25pemVkIGJ5IGFwcGl1bTogJHtleHRyYUNhcHMuam9pbignLCAnKX0uYCk7XG4gICAgfVxuICB9XG5cbiAgdmFsaWRhdGVEZXNpcmVkQ2FwcyAoY2Fwcykge1xuICAgIGlmICghdGhpcy5zaG91bGRWYWxpZGF0ZUNhcHMpIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICB2YWxpZGF0ZUNhcHMoY2FwcywgdGhpcy5fY29uc3RyYWludHMpO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIGxvZy5lcnJvckFuZFRocm93KG5ldyBlcnJvcnMuU2Vzc2lvbk5vdENyZWF0ZWRFcnJvcihgVGhlIGRlc2lyZWRDYXBhYmlsaXRpZXMgb2JqZWN0IHdhcyBub3QgdmFsaWQgZm9yIHRoZSBgICtcbiAgICAgICAgICAgICAgICAgICAgYGZvbGxvd2luZyByZWFzb24ocyk6ICR7ZS5tZXNzYWdlfWApKTtcbiAgICB9XG5cbiAgICB0aGlzLmxvZ0V4dHJhQ2FwcyhjYXBzKTtcblxuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgaXNNanNvbndwUHJvdG9jb2wgKCkge1xuICAgIHJldHVybiB0aGlzLnByb3RvY29sID09PSBCYXNlRHJpdmVyLkRSSVZFUl9QUk9UT0NPTC5NSlNPTldQO1xuICB9XG5cbiAgaXNXM0NQcm90b2NvbCAoKSB7XG4gICAgcmV0dXJuIHRoaXMucHJvdG9jb2wgPT09IEJhc2VEcml2ZXIuRFJJVkVSX1BST1RPQ09MLlczQztcbiAgfVxuXG4gIHNldFByb3RvY29sTUpTT05XUCAoKSB7XG4gICAgdGhpcy5wcm90b2NvbCA9IEJhc2VEcml2ZXIuRFJJVkVSX1BST1RPQ09MLk1KU09OV1A7XG4gIH1cblxuICBzZXRQcm90b2NvbFczQyAoKSB7XG4gICAgdGhpcy5wcm90b2NvbCA9IEJhc2VEcml2ZXIuRFJJVkVSX1BST1RPQ09MLlczQztcbiAgfVxuXG4gIC8qKlxuICAgKiBUZXN0IGNyZWF0ZVNlc3Npb24gaW5wdXRzIHRvIHNlZSBpZiB0aGlzIGlzIGEgVzNDIFNlc3Npb24gb3IgYSBNSlNPTldQIFNlc3Npb25cbiAgICovXG4gIHN0YXRpYyBkZXRlcm1pbmVQcm90b2NvbCAoZGVzaXJlZENhcGFiaWxpdGllcywgcmVxdWlyZWRDYXBhYmlsaXRpZXMsIGNhcGFiaWxpdGllcykge1xuICAgIHJldHVybiBfLmlzUGxhaW5PYmplY3QoY2FwYWJpbGl0aWVzKSA/XG4gICAgICBCYXNlRHJpdmVyLkRSSVZFUl9QUk9UT0NPTC5XM0MgOlxuICAgICAgQmFzZURyaXZlci5EUklWRVJfUFJPVE9DT0wuTUpTT05XUDtcbiAgfVxuXG4gIC8vIFRoaXMgaXMgdGhlIG1haW4gY29tbWFuZCBoYW5kbGVyIGZvciB0aGUgZHJpdmVyLiBJdCB3cmFwcyBjb21tYW5kXG4gIC8vIGV4ZWN1dGlvbiB3aXRoIHRpbWVvdXQgbG9naWMsIGNoZWNraW5nIHRoYXQgd2UgaGF2ZSBhIHZhbGlkIHNlc3Npb24sXG4gIC8vIGFuZCBlbnN1cmluZyB0aGF0IHdlIGV4ZWN1dGUgY29tbWFuZHMgb25lIGF0IGEgdGltZS4gVGhpcyBtZXRob2QgaXMgY2FsbGVkXG4gIC8vIGJ5IE1KU09OV1AncyBleHByZXNzIHJvdXRlci5cbiAgYXN5bmMgZXhlY3V0ZUNvbW1hbmQgKGNtZCwgLi4uYXJncykge1xuICAgIC8vIGdldCBzdGFydCB0aW1lIGZvciB0aGlzIGNvbW1hbmQsIGFuZCBsb2cgaW4gc3BlY2lhbCBjYXNlc1xuICAgIGxldCBzdGFydFRpbWUgPSBEYXRlLm5vdygpO1xuICAgIGlmIChjbWQgPT09ICdjcmVhdGVTZXNzaW9uJykge1xuICAgICAgLy8gSWYgY3JlYXRpbmcgYSBzZXNzaW9uIGRldGVybWluZSBpZiBXM0Mgb3IgTUpTT05XUCBwcm90b2NvbCB3YXMgcmVxdWVzdGVkIGFuZCByZW1lbWJlciB0aGUgY2hvaWNlXG4gICAgICB0aGlzLnByb3RvY29sID0gQmFzZURyaXZlci5kZXRlcm1pbmVQcm90b2NvbCguLi5hcmdzKTtcbiAgICAgIHRoaXMubG9nRXZlbnQoRVZFTlRfU0VTU0lPTl9JTklUKTtcbiAgICB9IGVsc2UgaWYgKGNtZCA9PT0gJ2RlbGV0ZVNlc3Npb24nKSB7XG4gICAgICB0aGlzLmxvZ0V2ZW50KEVWRU5UX1NFU1NJT05fUVVJVF9TVEFSVCk7XG4gICAgfVxuXG4gICAgLy8gaWYgd2UgaGFkIGEgY29tbWFuZCB0aW1lciBydW5uaW5nLCBjbGVhciBpdCBub3cgdGhhdCB3ZSdyZSBzdGFydGluZ1xuICAgIC8vIGEgbmV3IGNvbW1hbmQgYW5kIHNvIGRvbid0IHdhbnQgdG8gdGltZSBvdXRcbiAgICB0aGlzLmNsZWFyTmV3Q29tbWFuZFRpbWVvdXQoKTtcblxuICAgIC8vIElmIHdlIGRvbid0IGhhdmUgdGhpcyBjb21tYW5kLCBpdCBtdXN0IG5vdCBiZSBpbXBsZW1lbnRlZFxuICAgIC8vIElmIHRoZSB0YXJnZXQgZWxlbWVudCBpcyBJbWFnZUVsZW1lbnQsIHdlIG11c3QgdHJ5IHRvIGNhbGwgYEltYWdlRWxlbWVudC5leGVjdXRlYCB3aGljaCBleGlzdCBmb2xsb3dpbmcgbGluZXNcbiAgICAvLyBzaW5jZSBJbWFnZUVsZW1lbnQgc3VwcG9ydHMgZmV3IGNvbW1hbmRzIGJ5IGl0c2VsZlxuICAgIGNvbnN0IGltZ0VsSWQgPSBnZXRJbWdFbEZyb21BcmdzKGFyZ3MpO1xuICAgIGlmICghdGhpc1tjbWRdICYmICFpbWdFbElkKSB7XG4gICAgICB0aHJvdyBuZXcgZXJyb3JzLk5vdFlldEltcGxlbWVudGVkRXJyb3IoKTtcbiAgICB9XG5cbiAgICBsZXQgcmVzO1xuICAgIGlmICh0aGlzLmlzQ29tbWFuZHNRdWV1ZUVuYWJsZWQpIHtcbiAgICAgIC8vIFdoYXQgd2UncmUgZG9pbmcgaGVyZSBpcyBwcmV0dHkgY2xldmVyLiB0aGlzLmN1ckNvbW1hbmQgaXMgYWx3YXlzXG4gICAgICAvLyBhIHByb21pc2UgcmVwcmVzZW50aW5nIHRoZSBjb21tYW5kIGN1cnJlbnRseSBiZWluZyBleGVjdXRlZCBieSB0aGVcbiAgICAgIC8vIGRyaXZlciwgb3IgdGhlIGxhc3QgY29tbWFuZCBleGVjdXRlZCBieSB0aGUgZHJpdmVyIChpdCBzdGFydHMgb2ZmIGFzXG4gICAgICAvLyBlc3NlbnRpYWxseSBhIHByZS1yZXNvbHZlZCBwcm9taXNlKS4gV2hlbiBhIGNvbW1hbmQgY29tZXMgaW4sIHdlIHRhY2sgaXRcbiAgICAgIC8vIHRvIHRoZSBlbmQgb2YgdGhpcy5jdXJDb21tYW5kLCBlc3NlbnRpYWxseSBzYXlpbmcgd2Ugd2FudCB0byBleGVjdXRlIGl0XG4gICAgICAvLyB3aGVuZXZlciB0aGlzLmN1ckNvbW1hbmQgaXMgZG9uZS4gV2UgY2FsbCB0aGlzIG5ldyBwcm9taXNlIG5leHRDb21tYW5kLFxuICAgICAgLy8gYW5kIGl0cyByZXNvbHV0aW9uIGlzIHdoYXQgd2UgdWx0aW1hdGVseSB3aWxsIHJldHVybiB0byB3aG9tZXZlciBjYWxsZWRcbiAgICAgIC8vIHVzLiBNZWFud2hpbGUsIHdlIHJlc2V0IHRoaXMuY3VyQ29tbWFuZCB0byBfYmVfIG5leHRDb21tYW5kIChidXRcbiAgICAgIC8vIGlnbm9yaW5nIGFueSByZWplY3Rpb25zKSwgc28gdGhhdCBpZiBhbm90aGVyIGNvbW1hbmQgY29tZXMgaW50byB0aGVcbiAgICAgIC8vIHNlcnZlciwgaXQgZ2V0cyB0YWNrZWQgb24gdG8gdGhlIGVuZCBvZiBuZXh0Q29tbWFuZC4gVGh1cyB3ZSBjcmVhdGVcbiAgICAgIC8vIGEgY2hhaW4gb2YgcHJvbWlzZXMgdGhhdCBhY3RzIGFzIGEgcXVldWUgd2l0aCBzaW5nbGUgY29uY3VycmVuY3kuXG4gICAgICBsZXQgbmV4dENvbW1hbmQgPSB0aGlzLmN1ckNvbW1hbmQudGhlbigoKSA9PiB7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgcHJvbWlzZS9wcmVmZXItYXdhaXQtdG8tdGhlblxuICAgICAgICAvLyBpZiB3ZSB1bmV4cGVjdGVkbHkgc2h1dCBkb3duLCB3ZSBuZWVkIHRvIHJlamVjdCBldmVyeSBjb21tYW5kIGluXG4gICAgICAgIC8vIHRoZSBxdWV1ZSBiZWZvcmUgd2UgYWN0dWFsbHkgdHJ5IHRvIHJ1biBpdFxuICAgICAgICBpZiAodGhpcy5zaHV0ZG93blVuZXhwZWN0ZWRseSkge1xuICAgICAgICAgIHJldHVybiBCLnJlamVjdChuZXcgZXJyb3JzLk5vU3VjaERyaXZlckVycm9yKCdUaGUgZHJpdmVyIHdhcyB1bmV4cGVjdGVkbHkgc2h1dCBkb3duIScpKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBXZSBhbHNvIG5lZWQgdG8gdHVybiB0aGUgY29tbWFuZCBpbnRvIGEgY2FuY2VsbGFibGUgcHJvbWlzZSBzbyBpZiB3ZVxuICAgICAgICAvLyBoYXZlIGFuIHVuZXhwZWN0ZWQgc2h1dGRvd24gZXZlbnQsIGZvciBleGFtcGxlLCB3ZSBjYW4gY2FuY2VsIGl0IGZyb21cbiAgICAgICAgLy8gb3V0c2lkZSwgcmVqZWN0aW5nIHRoZSBjdXJyZW50IGNvbW1hbmQgaW1tZWRpYXRlbHlcbiAgICAgICAgdGhpcy5jdXJDb21tYW5kQ2FuY2VsbGFibGUgPSBCLnJlc29sdmUoKS50aGVuKCgpID0+IHsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBwcm9taXNlL3ByZWZlci1hd2FpdC10by10aGVuXG4gICAgICAgICAgLy8gaWYgb25lIG9mIHRoZSBhcmdzIGlzIGFuIGltYWdlIGVsZW1lbnQsIGhhbmRsZSBpdCBzZXBhcmF0ZWx5XG4gICAgICAgICAgaWYgKGltZ0VsSWQpIHtcbiAgICAgICAgICAgIHJldHVybiBJbWFnZUVsZW1lbnQuZXhlY3V0ZSh0aGlzLCBjbWQsIGltZ0VsSWQpO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gdGhpc1tjbWRdKC4uLmFyZ3MpO1xuICAgICAgICB9KS5jYW5jZWxsYWJsZSgpO1xuICAgICAgICByZXR1cm4gdGhpcy5jdXJDb21tYW5kQ2FuY2VsbGFibGU7XG4gICAgICB9KTtcbiAgICAgIHRoaXMuY3VyQ29tbWFuZCA9IG5leHRDb21tYW5kLmNhdGNoKCgpID0+IHt9KTtcbiAgICAgIHJlcyA9IGF3YWl0IG5leHRDb21tYW5kO1xuICAgIH0gZWxzZSB7XG4gICAgICBpZiAodGhpcy5zaHV0ZG93blVuZXhwZWN0ZWRseSkge1xuICAgICAgICB0aHJvdyBuZXcgZXJyb3JzLk5vU3VjaERyaXZlckVycm9yKCdUaGUgZHJpdmVyIHdhcyB1bmV4cGVjdGVkbHkgc2h1dCBkb3duIScpO1xuICAgICAgfVxuICAgICAgcmVzID0gYXdhaXQgdGhpc1tjbWRdKC4uLmFyZ3MpO1xuICAgIH1cblxuICAgIC8vIGlmIHdlIGhhdmUgc2V0IGEgbmV3IGNvbW1hbmQgdGltZW91dCAod2hpY2ggaXMgdGhlIGRlZmF1bHQpLCBzdGFydCBhXG4gICAgLy8gdGltZXIgb25jZSB3ZSd2ZSBmaW5pc2hlZCBleGVjdXRpbmcgdGhpcyBjb21tYW5kLiBJZiB3ZSBkb24ndCBjbGVhclxuICAgIC8vIHRoZSB0aW1lciAod2hpY2ggaXMgZG9uZSB3aGVuIGEgbmV3IGNvbW1hbmQgY29tZXMgaW4pLCB3ZSB3aWxsIHRyaWdnZXJcbiAgICAvLyBhdXRvbWF0aWMgc2Vzc2lvbiBkZWxldGlvbiBpbiB0aGlzLm9uQ29tbWFuZFRpbWVvdXQuIE9mIGNvdXJzZSB3ZSBkb24ndFxuICAgIC8vIHdhbnQgdG8gdHJpZ2dlciB0aGUgdGltZXIgd2hlbiB0aGUgdXNlciBpcyBzaHV0dGluZyBkb3duIHRoZSBzZXNzaW9uXG4gICAgLy8gaW50ZW50aW9uYWxseVxuICAgIGlmICh0aGlzLmlzQ29tbWFuZHNRdWV1ZUVuYWJsZWQgJiYgY21kICE9PSAnZGVsZXRlU2Vzc2lvbicpIHtcbiAgICAgIC8vIHJlc2V0aW5nIGV4aXN0aW5nIHRpbWVvdXRcbiAgICAgIHRoaXMuc3RhcnROZXdDb21tYW5kVGltZW91dCgpO1xuICAgIH1cblxuICAgIC8vIGxvZyB0aW1pbmcgaW5mb3JtYXRpb24gYWJvdXQgdGhpcyBjb21tYW5kXG4gICAgbGV0IGVuZFRpbWUgPSBEYXRlLm5vdygpO1xuICAgIHRoaXMuX2V2ZW50SGlzdG9yeS5jb21tYW5kcy5wdXNoKHtjbWQsIHN0YXJ0VGltZSwgZW5kVGltZX0pO1xuICAgIGlmIChjbWQgPT09ICdjcmVhdGVTZXNzaW9uJykge1xuICAgICAgdGhpcy5sb2dFdmVudChFVkVOVF9TRVNTSU9OX1NUQVJUKTtcbiAgICB9IGVsc2UgaWYgKGNtZCA9PT0gJ2RlbGV0ZVNlc3Npb24nKSB7XG4gICAgICB0aGlzLmxvZ0V2ZW50KEVWRU5UX1NFU1NJT05fUVVJVF9ET05FKTtcbiAgICB9XG5cbiAgICByZXR1cm4gcmVzO1xuICB9XG5cbiAgYXN5bmMgc3RhcnRVbmV4cGVjdGVkU2h1dGRvd24gKGVyciA9IG5ldyBlcnJvcnMuTm9TdWNoRHJpdmVyRXJyb3IoJ1RoZSBkcml2ZXIgd2FzIHVuZXhwZWN0ZWRseSBzaHV0IGRvd24hJykpIHtcbiAgICB0aGlzLnVuZXhwZWN0ZWRTaHV0ZG93bkRlZmVycmVkLnJlamVjdChlcnIpOyAvLyBhbGxvdyBvdGhlcnMgdG8gbGlzdGVuIGZvciB0aGlzXG4gICAgdGhpcy5zaHV0ZG93blVuZXhwZWN0ZWRseSA9IHRydWU7XG4gICAgYXdhaXQgdGhpcy5kZWxldGVTZXNzaW9uKHRoaXMuc2Vzc2lvbklkKTtcbiAgICB0aGlzLnNodXRkb3duVW5leHBlY3RlZGx5ID0gZmFsc2U7XG4gICAgdGhpcy5jdXJDb21tYW5kQ2FuY2VsbGFibGUuY2FuY2VsKGVycik7XG4gIH1cblxuICB2YWxpZGF0ZUxvY2F0b3JTdHJhdGVneSAoc3RyYXRlZ3ksIHdlYkNvbnRleHQgPSBmYWxzZSkge1xuICAgIGxldCB2YWxpZFN0cmF0ZWdpZXMgPSB0aGlzLmxvY2F0b3JTdHJhdGVnaWVzO1xuICAgIGxvZy5kZWJ1ZyhgVmFsaWQgbG9jYXRvciBzdHJhdGVnaWVzIGZvciB0aGlzIHJlcXVlc3Q6ICR7dmFsaWRTdHJhdGVnaWVzLmpvaW4oJywgJyl9YCk7XG5cbiAgICBpZiAod2ViQ29udGV4dCkge1xuICAgICAgdmFsaWRTdHJhdGVnaWVzID0gdmFsaWRTdHJhdGVnaWVzLmNvbmNhdCh0aGlzLndlYkxvY2F0b3JTdHJhdGVnaWVzKTtcbiAgICB9XG5cbiAgICBpZiAoIV8uaW5jbHVkZXModmFsaWRTdHJhdGVnaWVzLCBzdHJhdGVneSkpIHtcbiAgICAgIHRocm93IG5ldyBlcnJvcnMuSW52YWxpZFNlbGVjdG9yRXJyb3IoYExvY2F0b3IgU3RyYXRlZ3kgJyR7c3RyYXRlZ3l9JyBpcyBub3Qgc3VwcG9ydGVkIGZvciB0aGlzIHNlc3Npb25gKTtcbiAgICB9XG4gIH1cblxuICAvKlxuICAgKiBSZXN0YXJ0IHRoZSBzZXNzaW9uIHdpdGggdGhlIG9yaWdpbmFsIGNhcHMsXG4gICAqIHByZXNlcnZpbmcgdGhlIHRpbWVvdXQgY29uZmlnLlxuICAgKi9cbiAgYXN5bmMgcmVzZXQgKCkge1xuICAgIGxvZy5kZWJ1ZygnUmVzZXR0aW5nIGFwcCBtaWQtc2Vzc2lvbicpO1xuICAgIGxvZy5kZWJ1ZygnUnVubmluZyBnZW5lcmljIGZ1bGwgcmVzZXQnKTtcblxuICAgIC8vIHByZXNlcnZpbmcgc3RhdGVcbiAgICBsZXQgY3VycmVudENvbmZpZyA9IHt9O1xuICAgIGZvciAobGV0IHByb3BlcnR5IG9mIFsnaW1wbGljaXRXYWl0TXMnLCAnbmV3Q29tbWFuZFRpbWVvdXRNcycsICdzZXNzaW9uSWQnLCAncmVzZXRPblVuZXhwZWN0ZWRTaHV0ZG93biddKSB7XG4gICAgICBjdXJyZW50Q29uZmlnW3Byb3BlcnR5XSA9IHRoaXNbcHJvcGVydHldO1xuICAgIH1cblxuICAgIC8vIFdlIGFsc28gbmVlZCB0byBwcmVzZXJ2ZSB0aGUgdW5leHBlY3RlZCBzaHV0ZG93biwgYW5kIG1ha2Ugc3VyZSBpdCBpcyBub3QgY2FuY2VsbGVkIGR1cmluZyByZXNldC5cbiAgICB0aGlzLnJlc2V0T25VbmV4cGVjdGVkU2h1dGRvd24gPSAoKSA9PiB7fTtcblxuICAgIC8vIENvbnN0cnVjdCB0aGUgYXJndW1lbnRzIGZvciBjcmVhdGVTZXNzaW9uIGRlcGVuZGluZyBvbiB0aGUgcHJvdG9jb2wgdHlwZVxuICAgIGNvbnN0IGFyZ3MgPSB0aGlzLnByb3RvY29sID09PSBCYXNlRHJpdmVyLkRSSVZFUl9QUk9UT0NPTC5XM0MgP1xuICAgICAgW3VuZGVmaW5lZCwgdW5kZWZpbmVkLCB7YWx3YXlzTWF0Y2g6IHRoaXMuY2FwcywgZmlyc3RNYXRjaDogW3t9XX1dIDpcbiAgICAgIFt0aGlzLmNhcHNdO1xuXG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHRoaXMuZGVsZXRlU2Vzc2lvbih0aGlzLnNlc3Npb25JZCk7XG4gICAgICBsb2cuZGVidWcoJ1Jlc3RhcnRpbmcgYXBwJyk7XG4gICAgICBhd2FpdCB0aGlzLmNyZWF0ZVNlc3Npb24oLi4uYXJncyk7XG4gICAgfSBmaW5hbGx5IHtcbiAgICAgIC8vIGFsd2F5cyByZXN0b3JlIHN0YXRlLlxuICAgICAgZm9yIChsZXQgW2tleSwgdmFsdWVdIG9mIF8udG9QYWlycyhjdXJyZW50Q29uZmlnKSkge1xuICAgICAgICB0aGlzW2tleV0gPSB2YWx1ZTtcbiAgICAgIH1cbiAgICB9XG4gICAgdGhpcy5jbGVhck5ld0NvbW1hbmRUaW1lb3V0KCk7XG4gIH1cblxuICBhc3luYyBnZXRTd2lwZU9wdGlvbnMgKGdlc3R1cmVzLCB0b3VjaENvdW50ID0gMSkge1xuICAgIGxldCBzdGFydFggPSB0aGlzLmhlbHBlcnMuZ2V0Q29vcmREZWZhdWx0KGdlc3R1cmVzWzBdLm9wdGlvbnMueCksXG4gICAgICAgIHN0YXJ0WSA9IHRoaXMuaGVscGVycy5nZXRDb29yZERlZmF1bHQoZ2VzdHVyZXNbMF0ub3B0aW9ucy55KSxcbiAgICAgICAgZW5kWCA9IHRoaXMuaGVscGVycy5nZXRDb29yZERlZmF1bHQoZ2VzdHVyZXNbMl0ub3B0aW9ucy54KSxcbiAgICAgICAgZW5kWSA9IHRoaXMuaGVscGVycy5nZXRDb29yZERlZmF1bHQoZ2VzdHVyZXNbMl0ub3B0aW9ucy55KSxcbiAgICAgICAgZHVyYXRpb24gPSB0aGlzLmhlbHBlcnMuZ2V0U3dpcGVUb3VjaER1cmF0aW9uKGdlc3R1cmVzWzFdKSxcbiAgICAgICAgZWxlbWVudCA9IGdlc3R1cmVzWzBdLm9wdGlvbnMuZWxlbWVudCxcbiAgICAgICAgZGVzdEVsZW1lbnQgPSBnZXN0dXJlc1syXS5vcHRpb25zLmVsZW1lbnQgfHwgZ2VzdHVyZXNbMF0ub3B0aW9ucy5lbGVtZW50O1xuXG4gICAgLy8gdGhlcmUncyBubyBkZXN0aW5hdGlvbiBlbGVtZW50IGhhbmRsaW5nIGluIGJvb3RzdHJhcCBhbmQgc2luY2UgaXQgYXBwbGllcyB0byBhbGwgcGxhdGZvcm1zLCB3ZSBoYW5kbGUgaXQgaGVyZVxuICAgIGlmICh1dGlsLmhhc1ZhbHVlKGRlc3RFbGVtZW50KSkge1xuICAgICAgbGV0IGxvY1Jlc3VsdCA9IGF3YWl0IHRoaXMuZ2V0TG9jYXRpb25JblZpZXcoZGVzdEVsZW1lbnQpO1xuICAgICAgbGV0IHNpemVSZXN1bHQgPSBhd2FpdCB0aGlzLmdldFNpemUoZGVzdEVsZW1lbnQpO1xuICAgICAgbGV0IG9mZnNldFggPSAoTWF0aC5hYnMoZW5kWCkgPCAxICYmIE1hdGguYWJzKGVuZFgpID4gMCkgPyBzaXplUmVzdWx0LndpZHRoICogZW5kWCA6IGVuZFg7XG4gICAgICBsZXQgb2Zmc2V0WSA9IChNYXRoLmFicyhlbmRZKSA8IDEgJiYgTWF0aC5hYnMoZW5kWSkgPiAwKSA/IHNpemVSZXN1bHQuaGVpZ2h0ICogZW5kWSA6IGVuZFk7XG4gICAgICBlbmRYID0gbG9jUmVzdWx0LnggKyBvZmZzZXRYO1xuICAgICAgZW5kWSA9IGxvY1Jlc3VsdC55ICsgb2Zmc2V0WTtcbiAgICAgIC8vIGlmIHRoZSB0YXJnZXQgZWxlbWVudCB3YXMgcHJvdmlkZWQsIHRoZSBjb29yZGluYXRlcyBmb3IgdGhlIGRlc3RpbmF0aW9uIG5lZWQgdG8gYmUgcmVsYXRpdmUgdG8gaXQuXG4gICAgICBpZiAodXRpbC5oYXNWYWx1ZShlbGVtZW50KSkge1xuICAgICAgICBsZXQgZmlyc3RFbExvY2F0aW9uID0gYXdhaXQgdGhpcy5nZXRMb2NhdGlvbkluVmlldyhlbGVtZW50KTtcbiAgICAgICAgZW5kWCAtPSBmaXJzdEVsTG9jYXRpb24ueDtcbiAgICAgICAgZW5kWSAtPSBmaXJzdEVsTG9jYXRpb24ueTtcbiAgICAgIH1cbiAgICB9XG4gICAgLy8gY2xpZW50cyBhcmUgcmVzcG9uc2libGUgdG8gdXNlIHRoZXNlIG9wdGlvbnMgY29ycmVjdGx5XG4gICAgcmV0dXJuIHtzdGFydFgsIHN0YXJ0WSwgZW5kWCwgZW5kWSwgZHVyYXRpb24sIHRvdWNoQ291bnQsIGVsZW1lbnR9O1xuICB9XG5cbiAgcHJveHlBY3RpdmUgKC8qIHNlc3Npb25JZCAqLykge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIGdldFByb3h5QXZvaWRMaXN0ICgvKiBzZXNzaW9uSWQgKi8pIHtcbiAgICByZXR1cm4gW107XG4gIH1cblxuICBjYW5Qcm94eSAoLyogc2Vzc2lvbklkICovKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgLyoqXG4gICAqIFdoZXRoZXIgYSBnaXZlbiBjb21tYW5kIHJvdXRlIChleHByZXNzZWQgYXMgbWV0aG9kIGFuZCB1cmwpIHNob3VsZCBub3QgYmVcbiAgICogcHJveGllZCBhY2NvcmRpbmcgdG8gdGhpcyBkcml2ZXJcbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IHNlc3Npb25JZCAtIHRoZSBjdXJyZW50IHNlc3Npb25JZCAoaW4gY2FzZSB0aGUgZHJpdmVyIHJ1bnNcbiAgICogbXVsdGlwbGUgc2Vzc2lvbiBpZHMgYW5kIHJlcXVpcmVzIGl0KS4gVGhpcyBpcyBub3QgdXNlZCBpbiB0aGlzIG1ldGhvZCBidXRcbiAgICogc2hvdWxkIGJlIG1hZGUgYXZhaWxhYmxlIHRvIG92ZXJyaWRkZW4gbWV0aG9kcy5cbiAgICogQHBhcmFtIHtzdHJpbmd9IG1ldGhvZCAtIEhUVFAgbWV0aG9kIG9mIHRoZSByb3V0ZVxuICAgKiBAcGFyYW0ge3N0cmluZ30gdXJsIC0gdXJsIG9mIHRoZSByb3V0ZVxuICAgKlxuICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gLSB3aGV0aGVyIHRoZSByb3V0ZSBzaG91bGQgYmUgYXZvaWRlZFxuICAgKi9cbiAgcHJveHlSb3V0ZUlzQXZvaWRlZCAoc2Vzc2lvbklkLCBtZXRob2QsIHVybCkge1xuICAgIGZvciAobGV0IGF2b2lkU2NoZW1hIG9mIHRoaXMuZ2V0UHJveHlBdm9pZExpc3Qoc2Vzc2lvbklkKSkge1xuICAgICAgaWYgKCFfLmlzQXJyYXkoYXZvaWRTY2hlbWEpIHx8IGF2b2lkU2NoZW1hLmxlbmd0aCAhPT0gMikge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1Byb3h5IGF2b2lkYW5jZSBtdXN0IGJlIGEgbGlzdCBvZiBwYWlycycpO1xuICAgICAgfVxuICAgICAgbGV0IFthdm9pZE1ldGhvZCwgYXZvaWRQYXRoUmVnZXhdID0gYXZvaWRTY2hlbWE7XG4gICAgICBpZiAoIV8uaW5jbHVkZXMoWydHRVQnLCAnUE9TVCcsICdERUxFVEUnXSwgYXZvaWRNZXRob2QpKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgVW5yZWNvZ25pemVkIHByb3h5IGF2b2lkYW5jZSBtZXRob2QgJyR7YXZvaWRNZXRob2R9J2ApO1xuICAgICAgfVxuICAgICAgaWYgKCFfLmlzUmVnRXhwKGF2b2lkUGF0aFJlZ2V4KSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1Byb3h5IGF2b2lkYW5jZSBwYXRoIG11c3QgYmUgYSByZWd1bGFyIGV4cHJlc3Npb24nKTtcbiAgICAgIH1cbiAgICAgIGxldCBub3JtYWxpemVkVXJsID0gdXJsLnJlcGxhY2UoL15cXC93ZFxcL2h1Yi8sICcnKTtcbiAgICAgIGlmIChhdm9pZE1ldGhvZCA9PT0gbWV0aG9kICYmIGF2b2lkUGF0aFJlZ2V4LnRlc3Qobm9ybWFsaXplZFVybCkpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIGFkZE1hbmFnZWREcml2ZXIgKGRyaXZlcikge1xuICAgIHRoaXMubWFuYWdlZERyaXZlcnMucHVzaChkcml2ZXIpO1xuICB9XG5cbiAgZ2V0TWFuYWdlZERyaXZlcnMgKCkge1xuICAgIHJldHVybiB0aGlzLm1hbmFnZWREcml2ZXJzO1xuICB9XG59XG5cbkJhc2VEcml2ZXIuRFJJVkVSX1BST1RPQ09MID0ge1xuICBXM0M6ICdXM0MnLFxuICBNSlNPTldQOiAnTUpTT05XUCcsXG59O1xuXG5mb3IgKGxldCBbY21kLCBmbl0gb2YgXy50b1BhaXJzKGNvbW1hbmRzKSkge1xuICBCYXNlRHJpdmVyLnByb3RvdHlwZVtjbWRdID0gZm47XG59XG5cbmV4cG9ydCB7IEJhc2VEcml2ZXIgfTtcbmV4cG9ydCBkZWZhdWx0IEJhc2VEcml2ZXI7XG4iXSwiZmlsZSI6ImxpYi9iYXNlZHJpdmVyL2RyaXZlci5qcyIsInNvdXJjZVJvb3QiOiIuLi8uLi8uLiJ9
